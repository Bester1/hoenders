# Data Models

## Customer

**Purpose:** Represents registered customers who can place orders through the customer portal, extending beyond the simple name/email data currently stored with orders.

**Key Attributes:**
- customerId: UUID - Unique customer identifier generated by Supabase
- email: String (unique) - Primary login credential and communication method
- passwordHash: String - Securely hashed password managed by Supabase Auth
- name: String - Customer full name for invoices and communication
- phone: String - Contact number for delivery coordination
- address: Text - Delivery address for orders
- createdAt: Timestamp - Account creation date
- lastLogin: Timestamp - Last portal access for analytics
- isActive: Boolean - Account status (active/disabled)
- communicationPreferences: JSON - Email/SMS preferences, delivery instructions

**Relationships:**
- One-to-Many with Order (customer can have multiple orders)
- Links to existing orders through name/email matching for historical data

## Order (Extended)

**Purpose:** Extends existing order structure to support both customer portal orders and current PDF/CSV import workflows, maintaining backward compatibility.

**Key Attributes:**
- orderId: String - Existing unique order identifier pattern
- customerId: UUID (nullable) - Links to Customer table, null for imported orders
- source: Enum - 'customer_portal', 'pdf_import', 'csv_import' (new field)
- customerName: String - Customer name (from Customer or PDF/CSV)
- customerEmail: String - Email address for communications
- customerPhone: String - Contact phone number
- customerAddress: Text - Delivery address
- orderDate: Timestamp - When order was created
- status: Enum - 'pending', 'confirmed', 'processing', 'delivered', 'cancelled'
- totalAmount: Decimal - Total order value in ZAR
- notes: Text - Special instructions or admin notes

**Relationships:**
- Many-to-One with Customer (multiple orders per customer)
- One-to-Many with OrderItem (order contains multiple products)

## OrderItem

**Purpose:** Individual line items within an order, supporting both customer-selected quantities and PDF-extracted weights.

**Key Attributes:**
- orderItemId: UUID - Unique item identifier
- orderId: String - Links to parent Order
- productName: String - Product name from pricing catalog
- quantity: Integer - Number of items ordered
- weightKg: Decimal - Actual or estimated weight in kilograms
- unitPricePerKg: Decimal - Price per kilogram (selling price only for customers)
- lineTotal: Decimal - quantity × weightKg × unitPricePerKg
- source: Enum - 'customer_selection', 'pdf_extraction', 'admin_entry'

**Relationships:**
- Many-to-One with Order (multiple items per order)
- References product data from existing pricing object

## CustomerSession (New)

**Purpose:** Manages customer authentication sessions and security for the portal.

**Key Attributes:**
- sessionId: UUID - Unique session identifier
- customerId: UUID - Links to Customer
- jwtToken: Text - Encrypted JWT token for authentication
- createdAt: Timestamp - Session start time
- expiresAt: Timestamp - Session expiration time
- isActive: Boolean - Session validity status
- ipAddress: String - Security tracking
- userAgent: String - Browser information for security

**Relationships:**
- Many-to-One with Customer (customer can have multiple sessions)
